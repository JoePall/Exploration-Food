<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>New Recipe Explorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.0/css/bulma.css" />
    <script src="http://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <script src="./js/index.js"></script>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div class="container is-widescreen">
        <div class="content">
            <h1>Exploration Food <i id="space-shuttle" class="fas fa-space-shuttle"></i></h1>

            <form id="search-bar" class="field">
                <div class="field columns buttons are-large are-primary are-light">
                    <!-- <label class="label">Search</label> -->
                    <input id="search-text" class="input is-10" type="text" placeholder="Search for a recipe...">
                    <button id="search" type="submit" class="button">
                        <i class="fa fa-search" aria-hidden="true"></i>
                    </button>

                    <button id="filter" type="button" class="button">
                        <i class="fa fa-filter" title="preference control" aria-hidden="true"></i>
                    </button>
                    
                    <button id="save-search" type="button" class="button is-info is-outlined" title="Save this Search">
                        <i class="fa fa-save"></i>
                    </button>

                    <button type="reset" class="button is-danger is-outlined">
                        <i class="fas fa-undo"></i>
                    </button>
                </div>
                <div id="filter-content">
                    <!-- Add Allergy Selection here -->
                    <!-- Add Cuisine Selection here -->
                </div>
            </form>
        </div>
    </div>

    <!---Recipe Tiles HTML--->
    <section id="recipes">
        <!--Add Recipes here from API -->
    </section>

    <script>

        $(".recipe").click(event => {
            event.preventDefault();

            // Navigates to the recipe source
            location.href = $(this).source;
        });

        $("#filter").click(event => {
            event.preventDefault();

            if ($("#filter-content").hasClass("is-hidden")) {
                $("#filter-content").removeClass("is-hidden");
            } else {
                $("#filter-content").addClass("is-hidden");
            }
        });

        $("#search").click(event => {
            event.preventDefault();

            var preferences = getPreferencesInput();

            queryAPI(preferences, generateRecipeHTML);
        });

        function getPreferencesInput() {
            var result = {
                Search: "",
                Cuisine: [],
                Intolerances: [],
                Diet: [],
                Meal_Type: []
            };

            result.Search = $("#search-text").val();

            $.each($(".Cuisine>input:checked"), (i, item) =>
                result.Cuisine.push($(item).val()));

            $.each($(".Intolerances>input:checked"), (i, item) =>
                result.Intolerances.push($(item).val()));

            $.each($(".Meal_Type>input:checked"), (i, item) =>
                result.Meal_Type.push($(item).val()));

            $.each($(".Diet>input:checked"), (i, item) =>
                result.Diet.push($(item).val()));

            return result;
        }

        //queryParam needs to be in getCheckboxGroupHTML after testing...
        var queryParam = {
            Cuisine: {
                african: "african",
                american: "American",
                british: "British",
                cajun: "Cajun",
                caribbean: "Caribbean",
                chinese: "Chinese",
                eastern_European: "Eastern%20European",
                european: "European",
                french: "French",
                german: "German",
                greek: "Greek",
                indian: "Indian",
                irish: "Irish",
                italian: "Italian",
                japanese: "Japanese",
                jewish: "Jewish",
                korean: "Korean",
                latin_american: "Latin%20American",
                mediterranean: "Mediterranean",
                mexican: "Mexican",
                middle_Eastern: "Middle%20Eastern",
                nordic: "Nordic",
                southern: "Southern",
                spanish: "Spanish",
                thai: "Thai",
                vietnamese: "Vietnamese",
            },
            Intolerances: {
                dairy: "Dairy",
                egg: "Egg",
                gluten: "Gluten",
                grain: "Grain",
                peanut: "Peanut",
                seafood: "Seafood",
                sesame: "Sesame",
                shellfish: "Shellfish",
                soy: "Soy",
                sulfite: "Sulfite",
                tree_Nut: "Tree%20Nut",
                wheat: "Wheat",
            },
            Diet: {
                gluten_Free: "Gluten Free",
                ketogenic: "Ketogenic",
                vegetarian: "Vegetarian",
                lacto_Vegetarian: "Lacto-Vegetarian",
                ovo_Vegetarian: "Ovo-Vegetarian",
                vegan: "Vegan",
                pescetarian: "Pescetarian",
                paleo: "Paleo",
                primal: "Primal",
                whole30: "Whole30",
            },
            Meal_Type: {
                main_Course: "Main Course",
                side_Dish: "Side Dish",
                dessert: "Dessert",
                appetizer: "Appetizer",
                salad: "Salad",
                bread: "Bread",
                breakfast: "Breakfast",
                soup: "Soup",
                beverage: "Beverage",
                sauce: "Sauce",
                marinade: "Marinade",
                fingerfood: "Fingerfood",
                snack: "Snack",
                drink: "Drink",
            }
        };

        function getCheckboxGroupHTML(name, preferences) {
            var result = $("<section>").addClass("control");

            result.append($("<h1>").text(name.replace("_", " ")));

            var items = queryParam[name];
            for (var item in items) {
                console.log(item);
                var label = $("<label>").addClass("checkbox " + name);

                var checkbox = $("<input>").attr("type", "checkbox").addClass("checkbox").val(items[item]);

                if (preferences) {
                    if (preferences[name].includes(items[item])) {
                        $(checkbox).prop("checked", "true");
                    }
                }
                label.append(checkbox);
                label.append($("<p>").text(item.replace("_", " ")));

                result.append(label);
            }

            return result;
        }

        function loadFilterHTML(preferences) {
            $("#filter-content").empty();

            var groupNames = ["Intolerances", "Cuisine", "Diet", "Meal_Type"]
            groupNames.forEach(name => {
                $("#filter-content")
                    .append(getCheckboxGroupHTML(name, preferences))
                    .append("<br><hr><br>"); //Divider
            });
        }

        function generateRecipeHTML(recipe) {
            //TODO: Need to add center class to     ðŸ‘‡
            var result = $("<section>").addClass("recipe tile is-5 is-parent").val(recipe.source);

            var article = $("<article>").addClass("tile is-child notification is-primary");

            article.append($("<p>").addClass("title").text(recipe.title));
            article.append($("<p>").addClass("subtitle").html(recipe.summary));

            var figure = $("<figure>").addClass("image is-4by3");
            figure.append($("<img>").attr("src", recipe.image));
            article.append(figure);

            result.append(article);

            $("#recipe-container").append(result);
        }

        function init() {
            var test = {
                Search: "",
                Cuisine: [queryParam.Cuisine.African],
                Intolerances: [queryParam.Intolerances.Gluten],
                Diet: [queryParam.Diet.Ovo_Vegetarian],
                Meal_Type: [queryParam.Meal_Type.Breakfast]
            };

            loadFilterHTML(test);
            $("#filter-content").addClass("is-hidden");
            $("#search-text").focus();
        }
        init();

    </script>
</body>

</html>