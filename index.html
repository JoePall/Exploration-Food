<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>New Recipe Explorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.0/css/bulma.css" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <script src="./js/index.js"></script>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div class="container is-widescreen">
        <div class="content">
            <h1>Exploration Food <i class="fas fa-space-shuttle"></i></h1>

            <form id="search-bar" class="field">
                <div class="field columns buttons are-large are-primary are-light">
                    <label class="label">Search</label>
                    <input id="search-text" class="input is-10 is-rounded" type="text"
                        placeholder="Search for a recipe...">
                    <button id="search" type="submit" class="button">
                        <i class="fa fa-search" aria-hidden="true"></i>
                    </button>

                    <button id="filter" type="button" class="button">
                        <i class="fa fa-filter" aria-hidden="true"></i>
                    </button>

                    <button type="reset" class="button is-danger is-outlined">
                        <i class="fas fa-undo"></i>
                    </button>
                </div>
                <div id="filter-content">
                    <!-- Add Allergy Selection here -->
                    <!-- Add Cuisine Selection here -->
                </div>
            </form>
        </div>
    </div>

    <!---Recipe Tiles HTML--->
    <div id="recipe-container" class="tile is-ancestor">
        <!-- Recipe goes here -->
    </div>

    <script>
        var filter = false;

            //intolerances
            var intolerances = {
                Dairy: "Dairy",
                Egg: "Egg",
                Gluten: "Gluten",
                Wheat: "Wheat",
                Shellfish: "Shellfish",
                Peanuts: "Peanut",
                Tree_Nuts: "Tree Nut",
                Soy: "Soy"
            };

            //cuisine
            var cuisine = {
                Mexican: "American",
                Chinese: "Chinese",
                French: "French",
                German: "German",
                Indian: "Indian",
                Italian: "Italian",
                Mexican: "Mexican",
                Spanish: "Spanish"
            };
            //type
            var mealType = {
                Breakfast: "breakfast",
                Appetizer: "appetizer",
                Salad: "salad",
                Main_Course: "main course",
                Side_Dish: "side dish",
                Snack: "snack",
                Finger_Food: "fingerfood",
                Beverage: "beverage"
            };

            //ingredients to exclude
            var exclude = {
                Rice: "2044",
                Corn: "11168",
                Potatoes: "11362",
                Brussel_Sprouts: "11098",
                Banana: "9040",
                Blueberries: "9050",
                Green_Onions: "11291",
                Pearl_Onions: "10111282",
                Cilantro: "11165",
                Oysters: "15167",
                Anchovies: "15001",
                Beets: "11080",
                Blue_Cheese: "1004",
                Mayonnaise: "4025"

            }

            function getCheckboxGroupHTML(name, object, preferences) {
                var result = $("<section>").addClass("control");

                result.append($("<h3>").text(name));

                var keys = Object.keys(object);
                $(keys).each(key => {
                    var label = $("<label>").addClass("checkbox " + name);

                    var checkbox = $("<input>").attr("type", "checkbox").addClass("checkbox").val(object[keys[key]]);
                    var preference = name.toLowerCase();
                    if (keys[key] != undefined) {
                        if (preferences[preference].includes(keys[key])) {
                            $(checkbox).prop("checked", "true");
                        }
                    }
                    label.append(checkbox);
                    label.append($("<p>").text(keys[key].replace("_", " ")));

                    result.append(label);
                });

                return result;
            }

            $(".recipe").click(event => {
                event.preventDefault();

                // Navigates to the recipe source
                location.href = $(this).source;
            });

            $("#filter").click(event => {
                event.preventDefault();
                if (filter) {
                    $("#filter-content").show();
                } else {
                    $("#filter-content").hide();
                }
                filter = !filter;
            });

            function loadFilterHTML(preferences) {
                $("#filter-content").empty();

                $("#filter-content").append(getCheckboxGroupHTML("Intolerances", intolerances, preferences))
                    .append(getCheckboxGroupHTML("Cuisine", cuisine, preferences))
                    .append(getCheckboxGroupHTML("Meal_Type", mealType, preferences))
                    .append(getCheckboxGroupHTML("Exclude", exclude, preferences));
            }
            loadFilterHTML({
                cuisine: [],
                diet: [],
                intolerances: [],
                meal_type: [],
                exclude: [],
            });

            $("#search").click(event => {
                event.preventDefault();

                var preferences = getPreferencesInput();

                queryAPI(preferences, generateRecipeHTML);
            });

            function getPreferencesInput() {
                var result = {
                    searchText: "",
                    cuisine: [],
                    diet: [],
                    intolerances: [],
                    meal_type: [],
                    exclude: [],
                };

                result.searchText = $("#search-text").val();

                $.each($(".Allergies>input:checked"), (i, item) => {
                    result.intolerances.push($(item).val());
                });

                $.each($(".Cuisine>input:checked"), (i, item) => {
                    result.cuisine.push($(item).val());
                });

                $.each($(".Meal-Type>input:checked"), (i, item) => {
                    result.type.push($(item).val());
                });

                return result;
            }

            function generateRecipeHTML(recipe) {
                //TODO: Need to add center class to     ðŸ‘‡
                var result = $("<section>").addClass("recipe tile is-5 is-parent").val(recipe.source);

                var article = $("<article>").addClass("tile is-child notification is-primary");

                article.append($("<p>").addClass("title").text(recipe.title));
                article.append($("<p>").addClass("subtitle").html(recipe.summary));

                var figure = $("<figure>").addClass("image is-4by3");
                figure.append($("<img>").attr("src", recipe.image));
                article.append(figure);

                result.append(article);
                
                $("#recipe-container").append(result);
            }

            $("#search-text").focus();

    </script>
</body>

</html>