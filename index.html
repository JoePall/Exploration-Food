<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>New Recipe Explorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.0/css/bulma.css" />
    <script src="http://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <script src="./js/index.js"></script>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div class="container is-widescreen">
        <div class="content">
            <h1>Exploration Food <i class="fas fa-space-shuttle"></i></h1>

            <form id="search-bar" class="field">
                <div class="field columns buttons are-large are-primary are-light">
                    <!-- <label class="label">Search</label> -->
                    <input id="search-text" class="input is-10" type="text" placeholder="Search for a recipe...">
                    <button id="search" type="submit" class="button">
                        <i class="fa fa-search" aria-hidden="true"></i>
                    </button>

                    <button id="filter" type="button" class="button">
                        <i class="fa fa-filter" title="preferance conrol" aria-hidden="true"></i>
                    </button>

                    <button type="reset" class="button is-danger is-outlined">
                        <i class="fas fa-undo"></i>
                    </button>
                </div>
                <div id="filter-content">
                    <!-- Add Allergy Selection here -->
                    <!-- Add Cuisine Selection here -->
                </div>
            </form>
        </div>
    </div>

    <!---Recipe Tiles HTML--->
    <section id="recipies"></section>
            
  
   

    <script>
        //intolerances
        var intolerances = {
            Dairy: "Dairy",
            Egg: "Egg",
            Gluten: "Gluten",
            Wheat: "Wheat",
            Shellfish: "Shellfish",
            Peanuts: "Peanut",
            Tree_Nuts: "Tree Nut",
            Soy: "Soy"
        };
        //cuisine
        var cuisine = {
            Mexican: "American",
            Chinese: "Chinese",
            French: "French",
            German: "German",
            Indian: "Indian",
            Italian: "Italian",
            Mexican: "Mexican",
            Spanish: "Spanish"
        };
        //type
        var mealType = {
            Breakfast: "breakfast",
            Appetizer: "appetizer",
            Salad: "salad",
            Main_Course: "main course",
            Side_Dish: "side dish",
            Snack: "snack",
            Finger_Food: "fingerfood",
            Beverage: "beverage"
        };

        //ingredients to exclude
        var exclude = {
            starch:{
            rice: "2044",
            corn: "11168",
            potatoes: "11362",
            brussel_sprouts: "11098",
            bread: "18064"},

            vegetables: {
                brussel_sprouts: "11098",
                green_onions: "11291",
                pearl_onions: "10111282",
                cilantro: "11165",
                beets: "11080",
            },

            fruit: {
            banana: "9040",
            blueberries: "9050",
            navel_oranges: "9202",
            kiwis: "9148"
            },

            dairy: {
                blue_cheese: "1004",
                mayonnaise: "4025",
                milk: "1077",
                cheese: "1041009",   
            },

            meat: {
                oysters: "15167",
                anchovies: "15001",
                beef: "23572",
                lamb: "10017224",
                pork: "10010219"
            }
        }



        function getCheckboxGroupHTML(name, object) {
            var result = $("<section>").addClass("control");

            result.append($("<h3>").text(name));

            var keys = Object.keys(object);
            $(keys).each(key => {
                var label = $("<label>").addClass("checkbox " + name);

                label.append($("<input>").attr("type", "checkbox").val(object[keys[key]]));
                label.append($("<p>").text(keys[key].replace("_", " ")));

                result.append(label);
            });

            function getCheckboxGroupHTML(name, object, preferences) {
                var result = $("<section>").addClass("control");

                result.append($("<h3>").text(name));

                var keys = Object.keys(object);
                $(keys).each(key => {
                    var label = $("<label>").addClass("checkbox " + name);

                    var checkbox = $("<input>").attr("type", "checkbox").addClass("checkbox").val(object[keys[key]]);
                    var preference = name.toLowerCase();
                    if (keys[key] != undefined) {
                        if (preferences[preference].includes(keys[key])) {
                            $(checkbox).prop("checked", "true");
                        }
                    }
                    label.append(checkbox);
                    label.append($("<p>").text(keys[key].replace("_", " ")));

                    result.append(label);
                });

                return result;
            }

            $(".recipe").click(event => {
                event.preventDefault();

                // Navigates to the recipe source
                location.href = $(this).source;
            });

            $("#filter").click(event => {
                event.preventDefault();
                if (filter) {
                    $("#filter-content").show();
                } else {
                    $("#filter-content").hide();
                }
                filter = !filter;
            });

            function loadFilterHTML(preferences) {
                $("#filter-content").empty();
                var divider = "<br><br><hr><br><br>";

                $("#filter-content")
                    .append(getCheckboxGroupHTML("Cuisine", cuisine, preferences))
                    .append(getCheckboxGroupHTML("Meal_Type", mealType, preferences))
                    .append(getCheckboxGroupHTML("Exclude", exclude, preferences))
                    .append("<h1>Allergies<h1>")
                    .append(divider)
                    .append(getCheckboxGroupHTML("Intolerances", intolerances, preferences))
                    .append("<h1>Exclude<h1>")
                    .append(divider)
                    .append(getCheckboxGroupHTML("Starch", exclude.starch, preferences))
                    .append(getCheckboxGroupHTML("Vegetables", exclude.vegetables, preferences))
                    .append(getCheckboxGroupHTML("Fruit", exclude.fruit, preferences))
                    .append(getCheckboxGroupHTML("Dairy", exclude.dairy, preferences))
                    .append(getCheckboxGroupHTML("Meat", exclude.meat, preferences))
                    .append("<h1>Include<h1>")
                    .append(divider)
                    .append(getCheckboxGroupHTML("Cuisine", cuisine, preferences))
                    .append(getCheckboxGroupHTML("Meal-Type", mealType, preferences));
            }
            loadFilterHTML({
                cuisine: [cuisine.Indian, cuisine.French],
                diet: [],
                intolerances: [intolerances.Gluten],
                meal_type: [],
                // Watch this one ...   ðŸ‘‡
                exclude: [exclude.dairy.mayonnaise],
            });

            $("#search").click(event => {
                event.preventDefault();

                var preferences = getPreferencesInput();

                queryAPI(preferences, generateRecipeHTML);
            });

            function getPreferencesInput() {
                var result = {
                    searchText: "",
                    cuisine: [],
                    diet: [],
                    intolerances: [],
                    meal_type: [],
                    exclude: [],
                };

                result.searchText = $("#search-text").val();

                $.each($(".Allergies>input:checked"), (i, item) => {
                    result.intolerances.push($(item).val());
                });

                $.each($(".Cuisine>input:checked"), (i, item) => {
                    result.cuisine.push($(item).val());
                });

                $.each($(".Meal-Type>input:checked"), (i, item) => {
                    result.type.push($(item).val());
                });

                return result;
            }

            function generateRecipeHTML(recipe) {
                //TODO: Need to add center class to     ðŸ‘‡
                var result = $("<section>").addClass("recipe tile is-5 is-parent").val(recipe.source);

                var article = $("<article>").addClass("tile is-child notification is-primary");

                article.append($("<p>").addClass("title").text(recipe.title));
                article.append($("<p>").addClass("subtitle").html(recipe.summary));

                var figure = $("<figure>").addClass("image is-4by3");
                figure.append($("<img>").attr("src", recipe.image));
                article.append(figure);

                result.append(article);
                
                $("#recipe-container").append(result);
            }

            $("#search-text").focus();
        }
    </script>
</body>
</html>